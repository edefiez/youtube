<!DOCTYPE html>
<html>
<head>
</head>
<body>
<script>
	var player; 		// youtube player instance
	var messageSource;	// client source to send postMessage response

	// Load YouTube iframe api 
	var tag = document.createElement('script');
	tag.src = "https://www.youtube.com/iframe_api";
	var firstScriptTag = document.getElementsByTagName('script')[0];
	firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

	// declare youtube player
	function onYouTubeIframeAPIReady() {
		player = new YT.Player('player', {
			playerVars: { 'autoplay': 0, 'controls': 0, 'html5': 1 },
		});
		setInterval(updatePlayerInfo, 750);
	}

	// Display player Info
	function updatePlayerInfo() {
		if(!player)		return;
		if(!messageSource)	return;
		// get player information
		var info = {
			duration: player.getDuration(),
			currentTime: player.getCurrentTime()
		}
		// send player information to client with YTBeloola signature
		messageSource.postMessage({ YTBeloola: info }, document.URL);
	}
	
	window.addEventListener("message", function(event) {
		var message	= event.data;
		// only manage YTBeloola message signature
		if(typeof message === "object" && Object.keys(message)[0] === 'YTBeloola') {
			// build player commmand
			var command = "player."+message.YTBeloola;
			// eval command
			if(player)	eval(command);
			// save event source (message)
			if(!messageSource) {
				messageSource = event.source;
			}
		}
	}, false);

</script>
<div id="player" width="100%" height="100%"></div>
</body>
</html>